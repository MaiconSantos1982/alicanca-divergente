<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proteção Emocional - Aliança Divergente</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="dashboard-page">
    
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="novo-protocolo.html">
                <i data-feather="arrow-left" class="feather-sm"></i>
                <span class="brand-title">Proteção Emocional</span>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <span class="navbar-text me-3">
                            <i data-feather="user" class="feather-sm"></i>
                            <span id="userName">Carregando...</span>
                        </span>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-gold btn-sm" onclick="logout()">
                            <i data-feather="log-out" class="feather-sm"></i>
                            Sair
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10 col-xl-9">
                
                <!-- Header -->
                <div class="form-header mb-4">
                    <div class="form-header-icon">
                        <i data-feather="shield"></i>
                    </div>
                    <div class="form-header-content">
                        <h1 class="form-title">Protocolo de Proteção Emocional</h1>
                        <p class="form-subtitle">Proteja-se de invasões e dependências emocionais</p>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-container mb-4">
                    <div class="progress-bar-custom">
                        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                    </div>
                    <p class="progress-text" id="progressText">0% completo</p>
                </div>

                <!-- Alert Container -->
                <div id="alertContainer"></div>

                <!-- Info Box -->
                <div class="info-box mb-4">
                    <div class="info-icon">
                        <i data-feather="info"></i>
                    </div>
                    <div class="info-content">
                        <p class="mb-0">
                            <strong>Utilize este material em conjunto com o Protocolo de Combate à Dependência Emocional</strong><br>
                            Ativa: para se proteger de recaídas<br>
                            Passiva: para se proteger de insistência de invasão de núcleo
                        </p>
                    </div>
                </div>

                <!-- Formulário -->
                <form id="protecaoEmocionalForm" class="protocol-form">
                    
                    <!-- Informações Básicas -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <i data-feather="info" class="feather-sm"></i>
                            <h3>Informações Básicas</h3>
                        </div>
                        <div class="form-card-body">
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label for="nome" class="form-label">Nome (opcional)</label>
                                    <input type="text" class="form-control" id="nome" placeholder="Seu nome">
                                </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="dataPreenchimento" class="form-label">Data *</label>
                                    <input type="date" class="form-control" id="dataPreenchimento" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 1. Envolvido -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">1</span>
                            <h3>Envolvido(a)</h3>
                        </div>
                        <div class="form-card-body">
                            <label for="envolvido" class="form-label">
                                Quem é a outra parte? *
                            </label>
                            <input type="text" class="form-control" id="envolvido" required
                                   oninput="updateProgress()"
                                   placeholder="Nome da pessoa envolvida">
                        </div>
                    </div>

                    <!-- 2. Padrão Controlador Persistente -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">2</span>
                            <h3>Identifique o Padrão Controlador Persistente</h3>
                        </div>
                        <div class="form-card-body">
                            <p class="mb-3 text-muted">Marque qual ou quais desses padrões você mais frequentemente usa como alvo da sua invasão:</p>
                            
                            <!-- Vítima Natural -->
                            <div class="pattern-card mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="padraoVitimanatural" 
                                           onchange="togglePatternFields('vitimanatural'); updateProgress()">
                                    <label class="form-check-label fw-bold" for="padraoVitimanatural">
                                        Vítima Natural
                                    </label>
                                </div>
                                <div id="fieldsVitimanatural" class="pattern-fields mt-3" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-6 mb-2">
                                            <label class="form-label small">Há quanto tempo isso acontece?</label>
                                            <input type="text" class="form-control form-control-sm" 
                                                   id="vitimanaturalTempo" placeholder="Ex: 2 anos">
                                        </div>
                                        <div class="col-md-6 mb-2">
                                            <label class="form-label small">O que você está esperando?</label>
                                            <input type="text" class="form-control form-control-sm" 
                                                   id="vitimanaturalEsperar" placeholder="Sua expectativa">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Vítima Intencional -->
                            <div class="pattern-card mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="padraoVitimaintencional" 
                                           onchange="togglePatternFields('vitimaintencional'); updateProgress()">
                                    <label class="form-check-label fw-bold" for="padraoVitimaintencional">
                                        Vítima Intencional
                                    </label>
                                </div>
                                <div id="fieldsVitimaintencional" class="pattern-fields mt-3" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-6 mb-2">
                                            <label class="form-label small">Há quanto tempo isso acontece?</label>
                                            <input type="text" class="form-control form-control-sm" 
                                                   id="vitimaintencionalTempo" placeholder="Ex: 2 anos">
                                        </div>
                                        <div class="col-md-6 mb-2">
                                            <label class="form-label small">O que você está esperando?</label>
                                            <input type="text" class="form-control form-control-sm" 
                                                   id="vitimaintencionalEsperar" placeholder="Sua expectativa">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Vingador -->
                            <div class="pattern-card mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="padraoVingador" 
                                           onchange="togglePatternFields('vingador'); updateProgress()">
                                    <label class="form-check-label fw-bold" for="padraoVingador">
                                        Vingador
                                    </label>
                                </div>
                                <div id="fieldsVingador" class="pattern-fields mt-3" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-6 mb-2">
                                            <label class="form-label small">Há quanto tempo isso acontece?</label>
                                            <input type="text" class="form-control form-control-sm" 
                                                   id="vingadorTempo" placeholder="Ex: 2 anos">
                                        </div>
                                        <div class="col-md-6 mb-2">
                                            <label class="form-label small">O que você está esperando?</label>
                                            <input type="text" class="form-control form-control-sm" 
                                                   id="vingadorEsperar" placeholder="Sua expectativa">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Narcisista -->
                            <div class="pattern-card mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="padraoNarcisista" 
                                           onchange="togglePatternFields('narcisista'); updateProgress()">
                                    <label class="form-check-label fw-bold" for="padraoNarcisista">
                                        Narcisista
                                    </label>
                                </div>
                                <div id="fieldsNarcisista" class="pattern-fields mt-3" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-6 mb-2">
                                            <label class="form-label small">Há quanto tempo isso acontece?</label>
                                            <input type="text" class="form-control form-control-sm" 
                                                   id="narcisistaTempo" placeholder="Ex: 2 anos">
                                        </div>
                                        <div class="col-md-6 mb-2">
                                            <label class="form-label small">O que você está esperando?</label>
                                            <input type="text" class="form-control form-control-sm" 
                                                   id="narcisistaEsperar" placeholder="Sua expectativa">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <!-- 3. Análise dos Termos da Relação -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">3</span>
                            <h3>Análise dos Termos da Relação</h3>
                        </div>
                        <div class="form-card-body">
                            <label class="form-label">Foi feito um contrato/combinado? (Combate já foi feito com uma conversa entre você e a pessoa?) *</label>
                            <div class="mb-3">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="contratoSim" name="contratoFeito" value="sim" onchange="toggleContratoDetails(); updateProgress()" required>
                                    <label class="form-check-label" for="contratoSim">Sim</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="contratoNao" name="contratoFeito" value="nao" onchange="toggleContratoDetails(); updateProgress()">
                                    <label class="form-check-label" for="contratoNao">Não</label>
                                </div>
                            </div>

                            <!-- Se sim -->
                            <div id="contratoSimDetails" class="mt-3" style="display:none;">
                                <label class="form-label">Quem está descumprindo?</label>
                                <select class="form-select mb-2" id="quemDescumprindo" onchange="updateProgress()">
                                    <option value="">Selecione...</option>
                                    <option value="eu">Eu</option>
                                    <option value="outra_pessoa">A outra pessoa</option>
                                </select>
                                <label class="form-label">O que está esperando da outra pessoa?</label>
                                <input type="text" class="form-control" id="esperandoOutraPessoa" placeholder="O que espera">
                            </div>
                            <!-- Se não -->
                            <div id="contratoNaoDetails" class="mt-3" style="display:none;">
                                <label class="form-label">Por que não foi feito?</label>
                                <input type="text" class="form-control mb-2" id="porqueNaoFeito" placeholder="Motivo">
                                <label class="form-label">Quando será feito?</label>
                                <input type="text" class="form-control" id="quandoSeraFeito" placeholder="Data prevista">
                            </div>
                        </div>
                    </div>

                    <!-- 4. Qual é o custo/dano de se manter nessa interferência? -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">4</span>
                            <h3>Custo / Dano</h3>
                        </div>
                        <div class="form-card-body">
                            <label class="form-label">Qual é o custo/dano de se manter nessa interferência?</label>
                            <textarea class="form-control" id="custoDanoInterferencia" rows="3"
                                placeholder="Explique brevemente"></textarea>
                        </div>
                    </div>

                    <!-- 5. Motivo da Insistência -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">5</span>
                            <h3>Por que você insiste?</h3>
                        </div>
                        <div class="form-card-body">
                            <label class="form-label">Marque os motivos:</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="motivoOferecendoAjuda">
                                <label class="form-check-label" for="motivoOferecendoAjuda">
                                    Porque está oferecendo ajuda
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="motivoFocandoExpectativa">
                                <label class="form-check-label" for="motivoFocandoExpectativa">
                                    Porque está focando na expectativa
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="motivoTentandoMudar">
                                <label class="form-check-label" for="motivoTentandoMudar">
                                    Porque quer tentar mudar a pessoa
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 6. O que você vai fazer diferente? -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">6</span>
                            <h3>O que vai fazer diferente?</h3>
                        </div>
                        <div class="form-card-body">
                            <label class="form-label">Descreva sua nova ação ou resposta:</label>
                            <textarea class="form-control" id="fazerDiferente" rows="2" placeholder="Indique sua estratégia diferente"></textarea>
                        </div>
                    </div>

                    <!-- 7. Análise dos tópicos (etapa 7) -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">7</span>
                            <h3>Análise dos tópicos (etapa 7)</h3>
                        </div>
                        <div class="form-card-body">
                            <label class="form-label">Faça uma análise sincera dos tópicos levantados no combate à dependência:</label>
                            <textarea class="form-control" id="analiseTopicos" rows="2"
                                placeholder="Autorreflexão..."></textarea>
                        </div>
                    </div>

                    <!-- 8. Marca Passos -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">8</span>
                            <h3>Marca Passos</h3>
                        </div>
                        <div class="form-card-body">
                            <div class="row">
                                <div class="col-md-4 mb-2">
                                    <label class="form-label">Percepções</label>
                                    <input type="text" class="form-control" id="marcaPassosPercepcoes" placeholder="Suas percepções">
                                </div>
                                <div class="col-md-4 mb-2">
                                    <label class="form-label">Decisões</label>
                                    <input type="text" class="form-control" id="marcaPassosDecisoes" placeholder="Suas decisões">
                                </div>
                                <div class="col-md-4 mb-2">
                                    <label class="form-label">Ações</label>
                                    <input type="text" class="form-control" id="marcaPassosAcoes" placeholder="Suas ações">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botões -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary btn-lg" onclick="window.history.back()">
                            <i data-feather="x" class="feather-sm"></i>
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <span class="btn-text">
                                <i data-feather="save" class="feather-sm"></i>
                                Salvar Protocolo
                            </span>
                            <span class="spinner-border spinner-border-sm d-none"></span>
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/client.js"></script>
    <script src="assets/js/protecao-emocional.js"></script>
    <script>feather.replace();</script>
</body>
</html>
