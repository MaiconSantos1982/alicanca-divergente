<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolo de Combate ao Medo - Aliança Divergente</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="dashboard-page">
    
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="novo-protocolo.html">
                <i data-feather="arrow-left" class="feather-sm"></i>
                <span class="brand-title">Protocolo de Combate ao Medo</span>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <span class="navbar-text me-3" id="userGreeting">
                            <i data-feather="user" class="feather-sm"></i>
                            <span id="userName">Carregando...</span>
                        </span>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-gold btn-sm" onclick="logout()">
                            <i data-feather="log-out" class="feather-sm"></i>
                            Sair
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <div class="row justify-content-center">
            <div class="col-12 col-xl-10">
                
                <!-- Header -->
                <div class="form-header mb-4">
                    <div class="form-header-icon">
                        <i data-feather="shield"></i>
                    </div>
                    <div class="form-header-content">
                        <h1 class="form-title">Protocolo de Combate ao Medo</h1>
                        <p class="form-subtitle">Entenda, avalie, desmente e supere seus medos</p>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-container mb-4">
                    <div class="progress-bar-custom">
                        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                    </div>
                    <p class="progress-text" id="progressText">0% completo</p>
                </div>

                <!-- Alert Container -->
                <div id="alertContainer"></div>

                <!-- Formulário -->
                <form id="combateMedoForm" class="protocol-form">
                    
                    <!-- Informações Básicas -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <i data-feather="info" class="feather-sm"></i>
                            <h3>Informações Básicas</h3>
                        </div>
                        <div class="form-card-body">
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label for="nome" class="form-label">Nome (opcional)</label>
                                    <input type="text" class="form-control" id="nome" placeholder="Seu nome">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="dataPreenchimento" class="form-label">Data *</label>
                                    <input type="date" class="form-control" id="dataPreenchimento" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SEÇÃO 1: Entendendo o Medo -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">1</span>
                            <h3>Entendendo o Medo</h3>
                        </div>
                        <div class="form-card-body">
                            
                            <!-- 1.1 -->
                            <div class="mb-4">
                                <label for="medoDescricao" class="form-label">
                                    <strong>1.1.</strong> Você está com medo de quê? *
                                </label>
                                <textarea class="form-control form-textarea" id="medoDescricao" rows="3" required
                                          oninput="updateProgress()"
                                          placeholder="Descreva aqui o medo que você está sentindo..."></textarea>
                            </div>

                            <!-- 1.2 -->
                            <div class="mb-4">
                                <label for="medoOrigem" class="form-label">
                                    <strong>1.2.</strong> De onde vem esse medo?
                                </label>
                                <textarea class="form-control form-textarea" id="medoOrigem" rows="3"
                                          oninput="updateProgress()"
                                          placeholder="O que estava acontecendo a primeira vez que você sentiu esse medo?"></textarea>
                            </div>

                            <!-- 1.3 -->
                            <div class="mb-4">
                                <label for="medoQuandoComecou" class="form-label">
                                    <strong>1.3.</strong> Quando ele começou?
                                </label>
                                <input type="text" class="form-control" id="medoQuandoComecou"
                                       oninput="updateProgress()"
                                       placeholder="Ex: Na infância, há 5 anos, recentemente...">
                            </div>

                            <!-- 1.4 -->
                            <div class="mb-4">
                                <label for="medoAprendeuComQuem" class="form-label">
                                    <strong>1.4.</strong> Você aprendeu esse medo com alguém?
                                </label>
                                <input type="text" class="form-control" id="medoAprendeuComQuem"
                                       oninput="updateProgress()"
                                       placeholder="Se sim, com quem?">
                            </div>

                            <!-- 1.5 -->
                            <div class="mb-4">
                                <label for="medoPessoaNucleo" class="form-label">
                                    <strong>1.5.</strong> Essa pessoa está no seu Núcleo Emocional Interno?
                                </label>
                                <input type="text" class="form-control" id="medoPessoaNucleo"
                                       oninput="updateProgress()"
                                       placeholder="Sim ou não, e em qual quadrante?">
                            </div>

                            <!-- 1.6 -->
                            <div class="mb-4">
                                <label for="medoQuemAlimenta" class="form-label">
                                    <strong>1.6.</strong> Quem mais alimenta esse medo?
                                </label>
                                <input type="text" class="form-control" id="medoQuemAlimenta"
                                       oninput="updateProgress()"
                                       placeholder="Outras pessoas que reforçam esse medo...">
                            </div>

                            <!-- 1.7 -->
                            <div class="mb-0">
                                <label for="medoAlimentadorNucleo" class="form-label">
                                    <strong>1.7.</strong> Essa(s) pessoa(s) está(ão) no seu Núcleo Emocional Interno?
                                </label>
                                <input type="text" class="form-control" id="medoAlimentadorNucleo"
                                       oninput="updateProgress()"
                                       placeholder="Sim ou não, e em qual quadrante?">
                            </div>

                        </div>
                    </div>

                    <!-- SEÇÃO 2: Avaliando o Impacto do Medo -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">2</span>
                            <h3>Avaliando o Impacto do Medo</h3>
                        </div>
                        <div class="form-card-body">
                            
                            <!-- 2.1 -->
                            <div class="mb-4">
                                <label for="impactoFazendoOuDeixando" class="form-label">
                                    <strong>2.1.</strong> O que você está fazendo ou deixando de fazer por causa desse medo? *
                                </label>
                                <textarea class="form-control form-textarea" id="impactoFazendoOuDeixando" rows="3" required
                                          oninput="updateProgress()"
                                          placeholder="Liste as ações e inações causadas pelo medo..."></textarea>
                            </div>

                            <!-- 2.2 -->
                            <div class="mb-4">
                                <label for="impactoRuim" class="form-label">
                                    <strong>2.2.</strong> O que acontece de ruim quando você sente esse medo e acredita nele? *
                                </label>
                                <textarea class="form-control form-textarea" id="impactoRuim" rows="3" required
                                          oninput="updateProgress()"
                                          placeholder="Consequências negativas de acreditar no medo..."></textarea>
                            </div>

                            <!-- 2.3 -->
                            <div class="mb-0">
                                <label for="impactoBomPerdido" class="form-label">
                                    <strong>2.3.</strong> O que de bom deixa de acontecer quando você sente esse medo e acredita nele? *
                                </label>
                                <textarea class="form-control form-textarea" id="impactoBomPerdido" rows="3" required
                                          oninput="updateProgress()"
                                          placeholder="Oportunidades e coisas boas que você perde..."></textarea>
                            </div>

                        </div>
                    </div>
                    <!-- SEÇÃO 3: Desmentindo o Medo -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">3</span>
                            <h3>Desmentindo o Medo</h3>
                        </div>
                        <div class="form-card-body">
                            
                            <!-- 3.1 -->
                            <div class="mb-4">
                                <label for="desmistificaPensamento" class="form-label">
                                    <strong>3.1.</strong> Qual o pensamento que alimenta esse medo? *
                                </label>
                                <textarea class="form-control form-textarea" id="desmistificaPensamento" rows="2" required
                                          oninput="updateProgress()"
                                          placeholder="Ex: Vou falhar, Não sou bom o suficiente..."></textarea>
                            </div>

                            <!-- 3.2 -->
                            <div class="mb-4">
                                <label for="desmistificaNivelVerdade" class="form-label">
                                    <strong>3.2.</strong> De 0 a 10, quanto esse pensamento é verdadeiro? *
                                    <span class="nivel-value" id="nivelVerdadeDisplay">5</span>
                                </label>
                                <input type="range" class="form-range" id="desmistificaNivelVerdade" min="0" max="10" value="5"
                                       oninput="document.getElementById('nivelVerdadeDisplay').textContent = this.value; updateProgress();">
                                <div class="nivel-markers">
                                    <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                    <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                                </div>
                            </div>

                            <!-- 3.3 -->
                            <div class="mb-4">
                                <label for="desmistificaAlguemPensaDiferente" class="form-label">
                                    <strong>3.3.</strong> Alguém pensa diferente de você sobre isso?
                                </label>
                                <select class="form-select" id="desmistificaAlguemPensaDiferente" onchange="updateProgress()">
                                    <option value="">Selecione...</option>
                                    <option value="true">Sim</option>
                                    <option value="false">Não</option>
                                </select>
                            </div>

                            <!-- 3.4 -->
                            <div class="mb-4">
                                <label for="desmistificaOQuePensamDiferente" class="form-label">
                                    <strong>3.4.</strong> O que essas pessoas pensam?
                                </label>
                                <textarea class="form-control form-textarea" id="desmistificaOQuePensamDiferente" rows="2"
                                          oninput="updateProgress()"
                                          placeholder="Como essas pessoas veem a situação..."></textarea>
                            </div>

                            <!-- 3.5 -->
                            <div class="mb-4">
                                <label for="desmistificaResultadosDesejados" class="form-label">
                                    <strong>3.5.</strong> Esse pensamento te leva aos resultados que você deseja?
                                </label>
                                <select class="form-select" id="desmistificaResultadosDesejados" onchange="updateProgress()">
                                    <option value="">Selecione...</option>
                                    <option value="true">Sim</option>
                                    <option value="false">Não</option>
                                </select>
                            </div>

                            <!-- 3.6 -->
                            <div class="mb-4">
                                <label for="desmistificaInfoFaltando" class="form-label">
                                    <strong>3.6.</strong> Que informação está faltando para você avaliar melhor?
                                </label>
                                <textarea class="form-control form-textarea" id="desmistificaInfoFaltando" rows="2"
                                          oninput="updateProgress()"
                                          placeholder="Dados, perspectivas ou conhecimentos que faltam..."></textarea>
                            </div>

                            <!-- 3.7 -->
                            <div class="mb-4">
                                <label for="desmistificaVersaoOposta" class="form-label">
                                    <strong>3.7.</strong> Qual seria a versão oposta desse pensamento? *
                                </label>
                                <textarea class="form-control form-textarea" id="desmistificaVersaoOposta" rows="2" required
                                          oninput="updateProgress()"
                                          placeholder="Ex: Se o medo é 'vou falhar', o oposto é 'vou ter sucesso'..."></textarea>
                            </div>

                            <!-- 3.8 -->
                            <div class="mb-4">
                                <label for="desmistificaPadraoVida" class="form-label">
                                    <strong>3.8.</strong> Esse é um padrão na sua vida? *
                                </label>
                                <textarea class="form-control form-textarea" id="desmistificaPadraoVida" rows="2" required
                                          oninput="updateProgress()"
                                          placeholder="Esse medo se repete? Em quais situações?"></textarea>
                            </div>

                            <!-- 3.9 -->
                            <div class="mb-4">
                                <label for="desmistificaTipoAtual" class="form-label">
                                    <strong>3.9.</strong> Seguindo esse padrão, que tipo de vida você está vivendo? *
                                </label>
                                <select class="form-select" id="desmistificaTipoAtual" required onchange="updateProgress()">
                                    <option value="">Selecione...</option>
                                    <option value="memoravel">Memorável</option>
                                    <option value="mediocre">Medíocre</option>
                                </select>
                            </div>

                            <!-- 3.10 -->
                            <div class="mb-0">
                                <label for="desmistificaTipoDesejado" class="form-label">
                                    <strong>3.10.</strong> Que tipo de vida você quer viver? *
                                </label>
                                <select class="form-select" id="desmistificaTipoDesejado" required onchange="updateProgress()">
                                    <option value="">Selecione...</option>
                                    <option value="memoravel">Memorável</option>
                                    <option value="mediocre">Medíocre</option>
                                </select>
                            </div>

                        </div>
                    </div>

                    <!-- SEÇÃO 4: Superando o Medo -->
                    <div class="form-card mb-4">
                        <div class="form-card-header">
                            <span class="question-number">4</span>
                            <h3>Superando o Medo</h3>
                        </div>
                        <div class="form-card-body">
                            
                            <!-- 4.1 PDA Descontrolado -->
                            <h5 class="subsection-title mb-3">4.1. PDA Descontrolado (guiado pelo medo)</h5>
                            
                            <div class="mb-3">
                                <label for="pdaDescontroladoPercepcao" class="form-label">Percepção *</label>
                                <textarea class="form-control" id="pdaDescontroladoPercepcao" rows="2" required
                                          oninput="updateProgress()"
                                          placeholder="Como você percebe a situação quando está com medo?"></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="pdaDescontroladoDecisao" class="form-label">Decisão *</label>
                                <textarea class="form-control" id="pdaDescontroladoDecisao" rows="2" required
                                          oninput="updateProgress()"
                                          placeholder="Que decisão você toma quando está com medo?"></textarea>
                            </div>

                            <div class="mb-4">
                                <label for="pdaDescontroladoAcao" class="form-label">Ação *</label>
                                <textarea class="form-control" id="pdaDescontroladoAcao" rows="2" required
                                          oninput="updateProgress()"
                                          placeholder="Que ação você toma quando está com medo?"></textarea>
                            </div>

                            <hr class="my-4">

                            <!-- 4.2 Mapeamento de Possibilidades -->
                            <h5 class="subsection-title mb-3">4.2. Mapeamento de Possibilidades</h5>
                            
                            <div class="scenario-card mb-3">
                                <div class="scenario-header">Cenário 1: Acreditar no medo</div>
                                <div class="scenario-body">
                                    <label for="cenario1Consequencias" class="form-label">Consequências:</label>
                                    <textarea class="form-control" id="cenario1Consequencias" rows="2"
                                              oninput="updateProgress()"
                                              placeholder="O que acontece se você continuar acreditando no medo?"></textarea>
                                </div>
                            </div>

                            <div class="scenario-card mb-3">
                                <div class="scenario-header">Cenário 2: Confrontar e dar errado</div>
                                <div class="scenario-body">
                                    <label for="cenario2Bom" class="form-label">O que tem de bom nisso?</label>
                                    <textarea class="form-control mb-2" id="cenario2Bom" rows="2"
                                              oninput="updateProgress()"
                                              placeholder="Aprendizados, crescimento..."></textarea>
                                    
                                    <label for="cenario2Ruim" class="form-label">O que tem de ruim nisso?</label>
                                    <textarea class="form-control mb-2" id="cenario2Ruim" rows="2"
                                              oninput="updateProgress()"
                                              placeholder="Problemas, frustrações..."></textarea>
                                    
                                    <label for="cenario2Minimizar" class="form-label">Como minimizar o ruim?</label>
                                    <textarea class="form-control" id="cenario2Minimizar" rows="2"
                                              oninput="updateProgress()"
                                              placeholder="Estratégias de mitigação..."></textarea>
                                </div>
                            </div>

                            <div class="scenario-card mb-4">
                                <div class="scenario-header">Cenário 3: Confrontar e dar certo</div>
                                <div class="scenario-body">
                                    <label for="cenario3Bom" class="form-label">O que tem de bom nisso?</label>
                                    <textarea class="form-control mb-2" id="cenario3Bom" rows="2"
                                              oninput="updateProgress()"
                                              placeholder="Conquistas, realizações..."></textarea>
                                    
                                    <label for="cenario3Ruim" class="form-label">O que tem de ruim nisso?</label>
                                    <textarea class="form-control mb-2" id="cenario3Ruim" rows="2"
                                              oninput="updateProgress()"
                                              placeholder="Novos desafios, responsabilidades..."></textarea>
                                    
                                    <label for="cenario3Maximizar" class="form-label">Como maximizar o bom?</label>
                                    <textarea class="form-control" id="cenario3Maximizar" rows="2"
                                              oninput="updateProgress()"
                                              placeholder="Como potencializar os resultados positivos?"></textarea>
                                </div>
                            </div>

                            <hr class="my-4">

                            <!-- 4.3 Escolha do Cenário -->
                            <h5 class="subsection-title mb-3">4.3. Qual cenário você escolhe?</h5>
                            
                            <div class="mb-4">
                                <label for="cenarioEscolhido" class="form-label">Sua escolha:</label>
                                <select class="form-select" id="cenarioEscolhido" onchange="updateProgress()">
                                    <option value="">Selecione...</option>
                                    <option value="acreditar_medo">Cenário 1: Acreditar no medo</option>
                                    <option value="confrontar_dar_errado">Cenário 2: Confrontar e dar errado</option>
                                    <option value="confrontar_dar_certo">Cenário 3: Confrontar e dar certo</option>
                                </select>
                            </div>

                            <hr class="my-4">

                            <!-- 4.4 PDA Memorável -->
                            <h5 class="subsection-title mb-3">4.4. PDA Memorável (sem medo)</h5>
                            
                            <div class="mb-3">
                                <label for="pdaMemoravelPercepcao" class="form-label">Percepção *</label>
                                <textarea class="form-control" id="pdaMemoravelPercepcao" rows="2" required
                                          oninput="updateProgress()"
                                          placeholder="Como você percebe a situação sem o medo?"></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="pdaMemoravelDecisao" class="form-label">Decisão *</label>
                                <textarea class="form-control" id="pdaMemoravelDecisao" rows="2" required
                                          oninput="updateProgress()"
                                          placeholder="Que decisão você toma sem o medo?"></textarea>
                            </div>

                            <div class="mb-0">
                                <label for="pdaMemoravelAcao" class="form-label">Ação *</label>
                                <textarea class="form-control" id="pdaMemoravelAcao" rows="2" required
                                          oninput="updateProgress()"
                                          placeholder="Que ação você toma sem o medo?"></textarea>
                            </div>

                        </div>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary btn-lg" onclick="window.history.back()">
                            <i data-feather="x" class="feather-sm"></i>
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <span class="btn-text">
                                <i data-feather="save" class="feather-sm"></i>
                                Salvar Protocolo
                            </span>
                            <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                        </button>
                    </div>

                </form>

            </div>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div class="modal fade" id="confirmModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Protocolo Salvo! 🛡️</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Seu Protocolo de Combate ao Medo foi salvo com sucesso!</p>
                    <p>Deseja criar um PDA para começar a superar esse medo?</p>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" onclick="finishWithoutPDA()">
                        Não, obrigado
                    </button>
                    <button type="button" class="btn btn-primary" onclick="createPDA()">
                        <i data-feather="check-circle" class="feather-sm"></i>
                        Sim, criar PDA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Custom JS -->
    <script src="assets/js/client.js"></script>
    <script src="assets/js/form-combate-medo.js"></script>
    
    <script>
        feather.replace();
    </script>
</body>
</html>
